<!DOCTYPE html>
<html>
<head>
  <title>Re.corder</title>
  <script src="re_corder.js"></script>
  <script>
    var re_corder = undefined;

    const midi_setup = async (midi_access) => {
      const selector = document.querySelector('#input-port-selector');
      const none_option = document.createElement('option');
      none_option.textContent = 'None';
      selector.appendChild(none_option);
      midi_access.inputs.forEach(input => {
        const option = document.createElement('option');
        option.value = input.name;
        option.textContent = input.name;
        selector.appendChild(option);
      });
      selector.addEventListener('change', event => {
        if (re_corder) {
          re_corder.close();
          re_corder = undefined;
        }
        if (event.target.selectedIndex > 0) {
          const input_name = event.target.value;
          re_corder = create_re_corder(midi_access, input_name);
          console.log(`Created ${re_corder}.`);
        }
      });
    }

    const get_cfg = async () => {
      const text_area = document.getElementById('re_corder-config');
      text_area.value = await get_re_corder_config(re_corder);
    }

    const set_cfg = async () => {
      const text_area = document.getElementById('re_corder-config');
      text_area.value = await set_re_corder_config(re_corder, text_area.value);
    }

    window.addEventListener('load', () => {
      navigator.requestMIDIAccess({sysex: true, software: true})
        .then(midi_access => midi_setup(midi_access));
    });
  </script>
</head>
<body>
  <p>
    Re.corder Port <select id="input-port-selector"></select>
  </p>
  <p>
    <button onclick="get_cfg().catch(err => alert(err));">Get Config</button>
    <button onclick="set_cfg().then(() => alert('Success!')).catch(err => alert(`${err} --- Try holding Record, perhaps?`));">Set Config</button>
    <br>
    <textarea id="re_corder-config" rows="30" cols="50"></textarea>
  </p>
  <p>
  </p>
</body>
</html>
